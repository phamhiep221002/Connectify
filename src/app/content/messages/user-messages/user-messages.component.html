<div class="layout-wrapper d-lg-flex overflow-hidden" style="width: 100vw; height: 100vh;">
  <!-- Start the left bar menu -->
  <div class="side-menu flex-lg-column">
    <!-- Star logo brand box -->
    <div class="navbar-brand-box">
      <a routerLink="/" class="logo logo-brand">
        <span class="logo-sm">
          <img src="../favicon.ico" alt="logo" height="30" />
        </span>
      </a>
    </div>
    <!-- End logo brand box -->
    <!-- Start the side-mess menu -->
    <div class="flex-lg-column my-0 sidemenu-navigation">
      <ul class="nav nav-pills side-menu-nav" role="tablist">
        <li class="nav-item d-none d-lg-block" role="presentation">
          <a class="nav-link" id="pills-user-tab" data-bs-toggle="pill" href="#pills-user" role="tab"
            aria-selected="false" tabindex="-1">
            <i class="fa fa-user-o"></i>
          </a>
        </li>
        <li class="nav-item" role="presentation">
          <a class="nav-link active" (click)="setActiveTab('chat')" [class.active]="activeTab === 'chat'" href="javascript:void(0);" role="tab">
            <i class="fa fa-comment-o" aria-hidden="true">
            </i>
          </a>
        </li>
        <li class="nav-item" role="presentation">
          <a class="nav-link" (click)="setActiveTab('contacts')" [class.active]="activeTab === 'contacts'" href="javascript:void(0);" role="tab" tabindex="-1">
            <i class="fa fa-address-book-o" aria-hidden="true"> </i>
          </a>
        </li>
        <li class="nav-item" role="presentation">
          <a class="nav-link"  data-bs-toggle="pill" routerLink="/lists"
            aria-selected="false" tabindex="-1">
            <i class="fa fa-list-ul" aria-hidden="true"> </i>
          </a>
        </li>
        <li class="nav-item mt-lg-auto" role="presentation">
          <a class="nav-link setting" routerLink="/account-settings" aria-selected="false" tabindex="-1" role="tab">
            <i class="fa fa-cog"></i>
          </a>
        </li>
        <li class="nav-item profile-user-dropdown" role="presentation">
          <a class="nav-link bg-light" aria-haspopup="true" aria-expanded="false"
            *ngIf="accountService.currentUser$ | async as user">
            <img src="{{ user.photoUrl || './assets/user.png' }}" alt="profile-user"
              class="profile-user rounded-circle" />
          </a>
        </li>
      </ul>
    </div>
    <!-- End the side-mess menu -->
  </div>
  <!-- End the left bar menu -->
  <!-- Start chat left sidebar -->
  <div class="chat-leftsidebar">
    <div class="tab-content">
      <!-- Start Chatting tab -->
      <div *ngIf="activeTab === 'chat'" id="chat" role="tabpanel" class="active">
        <div>
          <div class="px-4 pt-4">
            <div class="d-flex align-items-start">
              <div class="d-flex flex-grow-1 flex-wrap-0 justify-content-between">
                <h4 class="mb-4">Messages</h4>
              </div>
            </div>
            <form>
              <div class="input-group search-panel mb-3">
                <div class="InputContainer">
                  <input placeholder="Search.." id="input" class="input" name="text" type="text"
                    (input)="loadConnectedMessages()" [(ngModel)]="fullName" />
                </div>
              </div>
            </form>
          </div>
          <div class="chat-room-list" data-simplebar="init">
            <div class="simplebar-wrapper" style="margin: 0px">
              <div class="simplebar-height-auto-observer-wrapper">
                <div class="simplebar-height-auto-observer"></div>
              </div>
              <div class="simplebar-mask">
                <div class="simplebar-offset" style="right: 0px; bottom: 0px">
                  <div class="simplebar-content-wrapper" style="height: auto">
                    <div #scrollConnectedMessage class="simplebar-content" style="padding: 0px"
                      (scroll)="onListUserMessageScroll($event)"
                      style="overflow-x: hidden; overflow-y: scroll; height: 100%"> 
                      <!-- Start chat-message-list -->
                      <h5 class="mb-3 px-4 mt-4 fs-11 text-muted text-uppercase">
                        Latest messages
                      </h5>

                      <div class="chat-message-list" *ngFor="let message of connectedMessage">
                        <ul class="list-unstyled chat-list chat-user-list" id="favourite-users">
                          <li id="contact-id-1" data-name="favorite" class="active">
                            <a routerLink="/messages/{{ message.userName }}" class="unread-msg-user">
                              <div class="d-flex align-items-center">
                                <div class="chat-user-img online align-self-center me-2 ms-0">
                                  <img src="{{
                                      message.photoUrl || './assets/user.png'
                                    }}" alt="Chat Avatar" class="rounded-circle avatar-xs" /><span
                                    class="user-status" *ngIf="(presenceService.onlineUsers$ | async)?.includes(message.userName)"></span>
                                </div>
                                <div class="overflow-hidden me-2">
                                  <p class="text-truncate chat-username mb-0">
                                    {{ message.fullName | titlecase }}
                                  </p>
                                  <p class="text-truncate text-muted fs-13 mb-0">
                                    {{ message.lastMessage }}
                                  </p>
                                </div>
                                <div class="ms-auto">
                                  <span class="badge badge-soft-danger rounded p-1 fs-10">{{message.unreadCount}}</span>
                                </div>
                              </div>
                            </a>
                          </li>
                        </ul>
                      </div>
                      <!-- End chat-message-list -->
                    </div>
                  </div>
                </div>
              </div>
              <div class="simplebar-placeholder" style="width: auto; height: 1128px"></div>
            </div>
            <div class="simplebar-track simplebar-horizontal" style="visibility: hidden">
              <div class="simplebar-scrollbar" style="width: 0px; display: none"></div>
            </div>
            <div class="simplebar-track simplebar-vertical" style="visibility: visible">
              <div class="simplebar-scrollbar" style="
                  height: 323px;
                  transform: translate3d(0px, 0px, 0px);
                  display: block;
                "></div>
            </div>
          </div>
        </div>
      </div>
      
      <div *ngIf="activeTab === 'contacts'" id="contacts" role="tabpanel">
        <div>
          <div class="px-4 pt-4">
            <div class="d-flex align-items-start">
              <div class="d-flex flex-grow-1 flex-wrap-0 justify-content-between">
                <h4 class="mb-4">Contacts</h4>
              </div>
            </div>
            <div class="input-group search-panel mb-3">
              <div class="InputContainer">
                <input placeholder="Search.." name="fullName" class="input" type="text" [(ngModel)]="search"
                  (input)="loadSearchLikeConnected()" />
              </div>
            </div>
          </div>
          <div class="chat-room-list" data-simplebar="init">
            <div class="simplebar-wrapper" style="margin: 0px">
              <div class="simplebar-height-auto-observer-wrapper">
                <div class="simplebar-height-auto-observer"></div>
              </div>
              <div class="simplebar-mask">
                <div class="simplebar-offset" style="right: 0px; bottom: 0px">
                  <div class="simplebar-content-wrapper" style="height: auto">
                    <div #scrollConnected class="simplebar-content" style="padding: 0px"
                      (scroll)="onConnectedScroll($event)"
                      style="overflow-x: hidden; overflow-y: scroll; height: 100%">
                      <!-- Start chat-message-list -->
                      <h5 class="mb-3 px-4 mt-4 fs-11 text-muted text-uppercase">
                        Connected users
                      </h5>

                      <div class="chat-message-list" *ngFor="let member of members">
                        <ul class="list-unstyled chat-list chat-user-list" id="favourite-users">
                          <li id="contact-id-1" data-name="favorite" class="active">
                            <a routerLink="/messages/{{ member.userName }}" class="unread-msg-user">
                              <div class="d-flex align-items-center">
                                <div class="chat-user-img online align-self-center me-2 ms-0">
                                  <img src="{{
                                        member.photoUrl || './assets/user.png'
                                      }}" alt="Chat Avatar" class="rounded-circle avatar-xs" /><span
                                    class="user-status" *ngIf="(presenceService.onlineUsers$ | async)?.includes(member.userName)"></span>
                                </div>
                                <div class="overflow-hidden me-2">
                                  <p class="text-truncate chat-username mb-0">
                                    {{ member.fullName | titlecase }}
                                  </p>
                                </div>
                              </div>
                            </a>
                          </li>
                        </ul>
                      </div>
                      <!-- End chat-message-list -->
                    </div>
                  </div>
                </div>
              </div>
              <div class="simplebar-placeholder" style="width: auto; height: 1128px"></div>
            </div>
            <div class="simplebar-track simplebar-horizontal" style="visibility: hidden">
              <div class="simplebar-scrollbar" style="width: 0px; display: none"></div>
            </div>
            <div class="simplebar-track simplebar-vertical" style="visibility: visible">
              <div class="simplebar-scrollbar" style="
                    height: 323px;
                    transform: translate3d(0px, 0px, 0px);
                    display: block;
                  "></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="user-chat w-100 overflow-hidden">
    <div class="chat-content d-lg-flex">
      <!-- start chat conversation section -->
      <div class="w-100 overflow-hidden position-relative">
        <!-- conversation user -->
        <div id="users-chat" class="position-relative" style="display: block">
          <div class="py-3 user-chat-topbar">
            <div class="row align-items-center">
              <div class="col-sm-4 col-8">
                <div class="d-flex align-items-center">
                  <div class="flex-grow-1 overflow-hidden">
                    <div class="d-flex align-items-center">
                      <div class="flex-shrink-0 chat-user-img online user-own-img align-self-center me-3 ms-0">
                        <img src="{{member.photoUrl || './assets/user.png'}}" class="rounded-circle avatar-sm"
                          alt="image of user" />
                        <span class="user-status" *ngIf="(presenceService.onlineUsers$ | async)?.includes(member.userName)"></span>
                      </div>
                      <div class="flex-grow-1 overflow-hidden">
                        <h6 class="text-truncate mb-0 fs-18">
                          <a style="text-decoration: none" class="user-profile-show text-reset">
                            {{member.knownAs}}</a>
                        </h6>
                        <p class="text-truncate text-muted mb-0"
                          *ngIf="(presenceService.onlineUsers$ | async)?.includes(member.userName)">
                          <small>Online</small>
                        </p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-sm-8 col-4">
                <ul class="list-inline user-chat-nav text-end mb-0">
                  <li class="list-inline-item d-lg-inline-block me-2 ms-0">
                    <button type="button" class="btn nav-btn" data-bs-toggle="modal" data-bs-target=".audiocallModal"
                      (click)="callOpen()">
                      <i class="fa fa-phone"></i>
                    </button>
                  </li>

                  <li class="list-inline-item d-lg-inline-block me-2 ms-0">
                    <button type="button" class="btn nav-btn" data-bs-toggle="modal" data-bs-target=".videocallModal"
                      (click)="callOpen()">
                      <i class="fa fa-video-camera"></i>
                    </button>
                  </li>
                </ul>
              </div>
            </div>
          </div>
          <!-- end chat user head -->

          <!-- start chat conversation -->

          <div class="chat-conversation p-3 p-lg-4" id="chat-conversation" data-simplebar="init">
            <div class="simplebar-wrapper" style="margin: -24px">
              <div class="simplebar-height-auto-observer-wrapper">
                <div class="simplebar-height-auto-observer"></div>
              </div>
              <div class="simplebar-mask">
                <div class="simplebar-offset" style="right: 0px; bottom: 0px">
                  <div #scrollMe class="simplebar-content-wrapper" (scroll)="onScroll($event)"
                    style="overflow-x: hidden; overflow-y: scroll; height: 100%">

                    <div class="simplebar-content" style="padding: 24px">
                      <ul class="list-unstyled chat-conversation-list" id="users-conversation">
                        <li *ngFor="let message of (messageService.messageThread$ | async)"
                          [ngClass]="{'chat-list left': message.senderUsername === username, 'chat-list right': message.senderUsername !== username}">
                          <div class="conversation-list">
                            <div class="chat-avatar" *ngIf="message.senderUsername === username">
                              <img src="{{message.senderPhotoUrl || './assets/user.png'}}" alt="" />
                            </div>
                            <div class="user-chat-content">
                              <div class="ctext-wrap" 
                              (mouseenter)="handleHover(message.id, true)"
                                (mouseleave)="handleHover(message.id, false)">
                                <div class="ctext-wrap-content" *ngIf="message.messageType !== 'Image' && message.messageType !== 'Video' && message.messageType !== 'Location'&& message.messageType !== 'File' && message.messageType !== 'Audio' && message.messageType !== 'MissCall'&& message.messageType !== 'Call'">
                                  <div class="message-text">
                                    <p class="mb-0 ctext-content" (click)="selectMessage(message.id)">
                                      {{message.content}}
                                    </p>
                                  </div>
                                </div>
                                <div class="message-img mb-0" *ngIf="message.messageType === 'Image'">
                                  <div class="message-img-list">
                                    <div>
                                      <a class="popup-img d-inline-block" href="{{message.content}}" target="_blank">
                                        <img class="rounded border img-thumbnail" [src]="message.content" loading="lazy" />
                                      </a>
                                    </div>
                                  </div>
                                </div>
                                <div class="ctext-wrap-content" *ngIf="message.messageType === 'File'">
                                  <div class="p-3 border rounded-3">
                                    <div class="d-flex align-items-center attached-file">
                                      <div class="flex-shrink-0 avatar-sm me-3 ms-0 attached-file-avatar">
                                        <div class="avatar-title rounded-circle fs-20">
                                          <i class="fa fa-paperclip"></i>
                                        </div>
                                      </div>
                                      <div class="flex-grow-1 overflow-hidden">
                                        <div class="text-start">
                                          <a class="fileName" href="{{message.content}}" target="_blank">{{message.fileName}}</a>
                                        </div>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                                <div class="message-video" *ngIf="message.messageType === 'Video'">
                                  <div>
                                    <a class="popup-video d-inline-block" href="{{message.content}}" target="_blank">
                                      <video class="rounded border video-thumbnail" controls [src]="message.content" loading="lazy"></video>
                                    </a>
                                  </div>
                                </div>
                                <div class="message-audio" *ngIf="message.messageType === 'Audio'">
                                  <audio controls [src]="message.content">
                                  </audio>
                                </div>
                                <div class="ctext-wrap-content" *ngIf="message.messageType === 'Location'">
                                  <div class="message-location">
                                    <div class="mapper">
                                      <img class="rounded border location-thumbnail"
                                        [src]="getMapUrl(message.content.split(',')[0], message.content.split(',')[1])"
                                    >
                                      <div class="resize-btn-group">
                                        <button class="resize-btn" (click)="increaseZoom()">
                                          <svg fill="rgb(168, 38, 255)" width="64px" height="64px" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg" stroke="rgb(168, 38, 255)"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path d="M9,17h6v6a1,1,0,0,0,2,0V17h6a1,1,0,0,0,0-2H17V9a1,1,0,0,0-2,0v6H9a1,1,0,0,0,0,2Z"></path> </g></svg>
                                        </button>
                                        <button class="resize-btn-minus" (click)="decreaseZoom()">
                                          <svg width="64px" height="64px" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                            <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                                            <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                                            <g id="SVGRepo_iconCarrier">
                                              <path d="M5 12H19" stroke="rgb(168, 38, 255)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                                            </g>
                                          </svg>
                                        </button>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                                <div class="message-miss-call" *ngIf="message.messageType === 'MissCall'">
                                  <div class="p-3">
                                    <div class="d-flex align-items-center">
                                      <div class="flex-shrink-0 avatar-sm me-3 ms-0 miss-call-avatar">
                                        <div class="avatar-title rounded-circle fs-20 missed-call">
                                          <svg width="24px" height="24px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path d="M16.5303 3.46967C16.2374 3.17678 15.7625 3.17678 15.4696 3.46967C15.1767 3.76256 15.1767 4.23744 15.4696 4.53033L16.9393 6.00001L15.4696 7.46967C15.1768 7.76256 15.1768 8.23744 15.4696 8.53033C15.7625 8.82322 16.2374 8.82322 16.5303 8.53033L18 7.06067L19.4696 8.53031C19.7625 8.82321 20.2374 8.82321 20.5303 8.53031C20.8232 8.23742 20.8232 7.76255 20.5303 7.46965L19.0606 6.00001L20.5303 4.53035C20.8232 4.23745 20.8232 3.76258 20.5303 3.46969C20.2374 3.17679 19.7625 3.17679 19.4696 3.46969L18 4.93935L16.5303 3.46967Z" fill="#ffffff"></path> <path fill-rule="evenodd" clip-rule="evenodd" d="M10.6925 4.95067C9.52266 2.85455 6.68752 2.72683 5.00745 4.4069C4.10879 5.30556 3.3103 6.50048 3.25706 7.90468C3.17818 9.98561 3.71556 13.4408 7.13735 16.8626C10.5591 20.2844 14.0144 20.8218 16.0953 20.7429C17.4995 20.6897 18.6944 19.8912 19.5931 18.9925C21.2731 17.3125 21.1454 14.4773 19.0493 13.3075L17.8864 12.6585C16.5176 11.8946 14.7905 12.2201 13.6585 13.3384C13.6381 13.3533 13.5231 13.4323 13.3221 13.4421C13.0656 13.4545 12.4729 13.3633 11.5548 12.4452C10.6364 11.5267 10.5454 10.9339 10.5579 10.6776C10.5677 10.4768 10.6467 10.3619 10.6616 10.3415C11.7799 9.2095 12.1054 7.48242 11.3415 6.1136L10.6925 4.95067ZM6.06811 5.46756C7.17394 4.36173 8.78363 4.60832 9.38265 5.68167L10.0317 6.8446C10.4354 7.56801 10.2977 8.58415 9.58435 9.29747C9.51471 9.36712 9.09846 9.81276 9.0597 10.6043C9.02003 11.4146 9.38395 12.3956 10.4942 13.5058C11.604 14.6157 12.5847 14.9797 13.395 14.9403C14.1864 14.9018 14.6322 14.4858 14.7023 14.4158C15.4156 13.7025 16.432 13.5646 17.1554 13.9683L18.3183 14.6173C19.3916 15.2163 19.6382 16.826 18.5324 17.9319C17.7571 18.7072 16.9013 19.2113 16.0385 19.244C14.3031 19.3098 11.2774 18.8813 8.19801 15.802C5.11864 12.7226 4.6902 9.69684 4.75599 7.9615C4.7887 7.09872 5.29276 6.24291 6.06811 5.46756Z" fill="#ffffff"></path> </g></svg>
                                        </div>
                                      </div>
                                      <div class="flex-grow-1 overflow-hidden">
                                        <div class="text-start">
                                          <strong>{{message.content}}</strong>                                       
                                        </div>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                                <div class="message-call" *ngIf="message.messageType === 'Call'">
                                  <div class="p-3">
                                    <div class="d-flex align-items-center">
                                      <div class="flex-shrink-0 avatar-sm me-3 ms-0 call-avatar">
                                        <div class="avatar-title rounded-circle fs-20 called">
                                          <svg width="24px" height="24px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path fill-rule="evenodd" clip-rule="evenodd" d="M22.75 7C22.75 3.82436 20.1756 1.25 17 1.25C13.8243 1.25 11.25 3.82436 11.25 7C11.25 7.91847 11.4659 8.78866 11.8504 9.56061C11.859 9.5779 11.8623 9.5918 11.8634 9.6002C11.8639 9.60415 11.8638 9.60649 11.8638 9.60744L11.5662 10.7195C11.2878 11.7601 12.2398 12.7122 13.2805 12.4338L14.3925 12.1362C14.3911 12.1366 14.3916 12.1363 14.3925 12.1362C14.3935 12.1362 14.3958 12.1361 14.3998 12.1366C14.4082 12.1376 14.4221 12.141 14.4394 12.1496C15.2113 12.5341 16.0815 12.75 17 12.75C20.1756 12.75 22.75 10.1756 22.75 7ZM14.3935 12.136L14.3925 12.1362L14.3935 12.136ZM17 2.75C19.3472 2.75 21.25 4.65279 21.25 7C21.25 9.34721 19.3472 11.25 17 11.25C16.3188 11.25 15.677 11.0903 15.1081 10.8069C14.7889 10.6479 14.3977 10.5821 14.0058 10.6869L13.06 10.94L13.313 9.99416C13.4179 9.60224 13.352 9.2111 13.193 8.89186C12.9097 8.32298 12.75 7.68122 12.75 7C12.75 4.65279 14.6528 2.75 17 2.75Z" fill="#ffffff"></path> <path fill-rule="evenodd" clip-rule="evenodd" d="M3.00745 6.4069C4.68752 4.72683 7.52266 4.85455 8.69248 6.95067L9.34149 8.1136C10.1054 9.48242 9.77987 11.2095 8.66157 12.3415C8.64668 12.3619 8.56774 12.4768 8.55791 12.6776C8.54536 12.9339 8.63639 13.5267 9.55482 14.4452C10.4729 15.3633 11.0656 15.4545 11.3221 15.4421C11.5231 15.4323 11.6381 15.3533 11.6585 15.3384C12.7905 14.2201 14.5176 13.8946 15.8864 14.6585L17.0493 15.3075C19.1454 16.4773 19.2731 19.3125 17.5931 20.9925C16.6944 21.8912 15.4995 22.6897 14.0953 22.7429C12.0144 22.8218 8.55913 22.2844 5.13735 18.8626C1.71556 15.4408 1.17818 11.9856 1.25706 9.90468C1.3103 8.50048 2.10879 7.30556 3.00745 6.4069ZM7.38265 7.68167C6.78363 6.60832 5.17394 6.36173 4.06811 7.46756C3.29276 8.24291 2.7887 9.09872 2.75599 9.9615C2.6902 11.6968 3.11864 14.7226 6.19801 17.802C9.27737 20.8813 12.3031 21.3098 14.0385 21.244C14.9013 21.2113 15.7571 20.7072 16.5324 19.9319C17.6382 18.826 17.3916 17.2163 16.3183 16.6173L15.1554 15.9683C14.432 15.5646 13.4158 15.7023 12.7025 16.4156C12.6325 16.4856 12.1864 16.9018 11.395 16.9403C10.5847 16.9797 9.604 16.6157 8.49416 15.5058C7.38395 14.3956 7.02003 13.4146 7.0597 12.6043C7.09846 11.8128 7.51468 11.3672 7.58432 11.2975C8.29764 10.5842 8.43539 9.56801 8.03166 8.8446L7.38265 7.68167Z" fill="#ffffff"></path> </g></svg>                                        </div>
                                      </div>
                                      <div class="flex-grow-1 overflow-hidden">
                                        <div class="text-start">
                                          <strong>Called</strong>
                                          <p class="mb-0 ctext-content" (click)="selectMessage(message.id)">
                                            {{message.content}}
                                          </p>                                        
                                        </div>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                                <div class="align-self-start message-box-drop d-flex"  *ngIf="hoveredMessageId === message.id || selectedMessageId === message.id">
                                  <div class="dropdown message-box-dropdown">
                                    <a *ngIf="hoveredMessageId === message.id"
                                    (click)="toggleMessageBox(message.id)" role="button" data-bs-toggle="dropdown"
                                      aria-haspopup="true">
                                      <i class="fa fa-ellipsis-h"></i>
                                    </a>
                                    <div *ngIf="isMessageBoxVisible && selectedMessageId === message.id" class="dropdown-menu show" 
                                  
                                 data-popper-placement="bottom-start">
                                      <!-- <a class="dropdown-item d-flex align-items-center justify-content-between reply-message"
                                        href="#" id="reply-message-0" data-bs-toggle="collapse"
                                        data-bs-target=".replyCollapse">Reply
                                        <i class="fa fa-share ms-2 text-muted"></i></a>
                                      <a class="dropdown-item d-flex align-items-center justify-content-between" href="#"
                                        data-bs-toggle="modal" data-bs-target=".forwardModal">Forward
                                        <i class="fa fa-share-alt ms-2 text-muted"></i></a>
                                      <a class="dropdown-item d-flex align-items-center justify-content-between copy-message"
                                        href="#" id="copy-message-0">Copy
                                        <i class="fa fa-clone text-muted ms-2"></i></a>-->
                                      <a class="dropdown-item d-flex align-items-center justify-content-between delete-item"
                                        (click)="$event.stopPropagation()" (click)="deleteMessage(message.id); toggleMessageBox(message.id)">Remove
                                        <i class="fa fa-trash-o text-muted ms-2"></i></a>
                                      <a class="dropdown-item d-flex align-items-center justify-content-between" *ngIf="message.senderUsername != username && (message.messageType !== 'Unsent' && message.messageType !== 'MissCall' && message.messageType !== 'Call' && message.messageType !== 'MissCall')"
                                        (click)="$event.stopPropagation()" (click)="unsendMessage(message.id)">Unsend
                                        <i class="fa fa-undo text-muted ms-2"></i></a>
                                    </div>
                                  </div>
                                </div>
                              </div>
                              <div class="conversation-name">
                                <small class="text-muted">
                                  <span class="fa fa-clock-o">{{message.messageSent | timeago}}</span>
                                  <span *ngIf="!message.dateRead 
                                                      && message.senderUsername !== username"><i
                                      class="fa fa-circle-thin"></i></span>
                                  <span class="text-success check-message-icon" *ngIf="message.dateRead 
                                                      && message.senderUsername !== username"><i
                                      class="fa fa-check-circle"></i></span>
                                </small>
                              </div>
                            </div>
                          </div>
                        </li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="simplebar-placeholder" style="width: auto; height: 1199px"></div>
          </div>
          <div class="simplebar-track simplebar-horizontal" style="visibility: hidden">
            <div class="simplebar-scrollbar" style="
                  width: 0px;
                  display: none;
                  transform: translate3d(0px, 0px, 0px);
                "></div>
          </div>
          <div class="simplebar-track simplebar-vertical" style="visibility: visible">
            <div class="simplebar-scrollbar" style="
                  height: 337px;
                  display: block;
                  transform: translate3d(0px, 159px, 0px);
                "></div>
          </div>
        </div>
        <!-- end chat conversation end -->
        <!-- start chat input section -->
        <div class="position-relative">
          <div class="chat-input-section p-4 border-top">
            <form id="chatinput-form" enctype="multipart/form-data" #messageForm="ngForm" autocomplete="off">
              <div class="row g-0 align-items-center">
                <div class="col-auto">
                  <div class="chat-input-links me-md-2">
                    <div class="links-list-item" data-bs-toggle="tooltip" data-bs-trigger="hover"
                      data-bs-placement="top" aria-label="More" data-bs-original-title="More">
                      <button (click)="toggleChatinputMoreMenu()" type="button"
                        class="btn btn-link text-decoration-none btn-lg waves-effect collapsed"
                        data-bs-toggle="collapse" data-bs-target="#chatinputmorecollapse" aria-expanded="false"
                        aria-controls="chatinputmorecollapse">
                        <i class="fa fa-ellipsis-h align-middle"></i>
                      </button>
                    </div>
                  </div>
                </div>
                <div class="col">
                <form class="row g-0 align-items-center" #messageForm="ngForm" (ngSubmit)="sendCombinedMessage()"
                  autocomplete="off">
                  <div class="col">
                    <div class="position-relative">
                      <div class="chat-input-feedback">
                        Please Enter a Message
                      </div>
                      <input name="messageContent" required [(ngModel)]="messageContent" type="text"
                        class="form-input input-sm" placeholder="Type a message..." />
                    </div>
                  </div>
                  <div class="col-auto">
                    <div class="chat-input-links ms-2 gap-md-1">
                      <div class="links-list-item">
                        <button class="sends" [disabled]="!messageForm.valid && !selectedFile" type="submit">
                          <div class="svg-wrapper-1">
                            <div class="svg-wrapper">
                              <svg height="24" width="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path d="M0 0h24v24H0z" fill="none"></path>
                                <path
                                  d="M1.946 9.315c-.522-.174-.527-.455.01-.634l19.087-6.362c.529-.176.832.12.684.638l-5.454 19.086c-.15.529-.455.547-.679.045L12 14l6-8-8 6-8.054-2.685z"
                                  fill="currentColor"></path>
                              </svg>
                            </div>
                          </div>
                          <span><i *ngIf="loadingfile" class="fa fa-spinner fa-spin"></i></span>
                        </button>
                      </div>
                    </div>
                  </div>
                </form>
                </div>
              </div>
            </form>
            <div *ngIf="isChatinputMoreMenuVisible" class="dropup chat-input-collapse">
              <div class="card mb-0">
                <div class="card-body py-3">
                  <!-- Swiper -->
                  <div class="swiper chatinput-links">
                    <div class="swiper-wrapper">
                      <div class="swiper-slide">
                        <div class="text-center px-2 position-relative">
                          <div>
                            <input id="attachedfile-input" type="file" class="d-none" multiple=""
                              (change)="onFileSelected($event)" />
                            <label for="attachedfile-input" class="avatar-sm mx-auto stretched-link">
                              <span class="avatar-title fs-18 rounded-circle">
                                <i class="fa fa-paperclip"></i>
                              </span>
                            </label>
                          </div>
                          <h5 class="fs-11 text-uppercase mt-3 mb-0 text-body text-truncate">
                            Attached
                          </h5>
                        </div>
                      </div>
                      <div class="swiper-slide">
                        <div class="text-center px-2 position-relative">
                          <div>
                            <input id="galleryfile-input" type="file" class="d-none"
                              accept=".jpg, .jpeg, .png, .gif, .bmp, .tiff, .tif, .webp, .svg, .raw, .psd, .heic, .ai, .eps, .mp4, .avi, .mkv, .mov, .flv, .wmv, .m4v, .webm, .3gp, .mpeg, .mpg, .vob, .rm, .rmvb, .ts, .ogv, .swf"
                              multiple (change)="onFileSelected($event)" />
                            <label for="galleryfile-input" class="avatar-sm mx-auto stretched-link">
                              <span class="avatar-title fs-18 rounded-circle">
                                <i class="fa fa-file-image-o"></i>
                              </span>
                            </label>
                          </div>
                          <h5 class="fs-11 text-uppercase text-truncate mt-3 mb-0">
                            Gallery
                          </h5>
                        </div>
                      </div>
                      <div class="swiper-slide">
                        <div class="text-center px-2">
                          <div>
                            <input id="audiofile-input" type="file" class="d-none"
                              accept=".mp3, .wav, .ogg, .m4a, .aac, .flac, .wma, .alac, .ac3, .amr, .dts, .ra, .mid, .midi, .ape, .aiff, .mka"
                              multiple (change)="onFileSelected($event)" />
                            <label for="audiofile-input" class="avatar-sm mx-auto stretched-link">
                              <span class="avatar-title fs-18 rounded-circle">
                                <i class="fa fa-headphones"></i>
                              </span>
                            </label>
                          </div>
                          <h5 class="fs-11 text-uppercase text-truncate mt-3 mb-0">
                            Audio
                          </h5>
                        </div>
                      </div>
                      <div class="swiper-slide">
                        <div class="text-center px-2">
                          <div class="avatar-sm mx-auto">
                            <div class="avatar-title fs-18 rounded-circle">
                              <i class="fa fa-map-marker"></i>
                            </div>
                          </div>

                          <h5 class="fs-11 text-uppercase text-truncate mt-3 mb-0">
                            <a class="text-body stretched-link" (click)="sendLocationMessage()">Location</a>
                          </h5>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- end chat input section -->
      </div>
      <!-- end chat conversation section -->
    </div>
    <!-- end user chat content -->
  </div>
</div>